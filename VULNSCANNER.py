import socket
from IPy import IP

class portscan(): 
    banners = []
    open_ports = []
    def __init__(self, targetip, port_num): #constructor 3ady
        self.targetip = targetip
        self.port_num = port_num

    def scan(self): #bey3ady port port le7ad mayewsal el port number el e7na 7ateno
        for port in range(1, self.port_num):
            self.scan_port(port)
            print(port)


    def check_ip(self): #beyconvert URL into an IP address, wa bey7awel el targetip into IP datatype
        try:
            IP(self.targetip) #convert ip input into IP datatype
            return(self.targetip)
        except ValueError:
            return socket.gethostbyname(self.targetip) #convert URL to IP


    def scan_port(self, port):
        try:
            converted_ip = self.check_ip() # beysheel el IP datatype
            sock = socket.socket() 
            sock.settimeout(0.5)
            sock.connect((converted_ip, port)) #connect to socket to IP and to current port number (sent men function scan)
            self.open_ports.append(port) #beyadd kol port gowa list
            try:
                banner = sock.recv(1024).decode().strip('\n') #recieve a packet
                print(banner) #dah beytba3 el vulnerability nafso
                self.banners.append(banner) #beyadd kol vulnerability f list
            except:
                self.banners.append(' ') #law mafeesh banner recieved fa howa keda closed port, fa append empty data fel banners list
            sock.close()
        except:
            pass

targets_ip = input('[+] * Enter Target To Scan For Vulnerable Open Ports: ')
port_number = int(input('[+] * Enter Amount Of Ports You Want To Scan (500 - First 500 Ports): '))
# vul_file = input('[+] * Enter Path To The File With Vulnerable Softwares: ')

target = portscan(targets_ip, port_number)
target.scan()
# with open(vul_file,'r') as file:
count = 0
for banner in target.banners:
    #file.seek(0)
    # for line in file.readlines():
    #     if line.strip() in banner:
    #         print('[!!] VULNERABLE BANNER: "' + banner + '" ON PORT: ' + str(target.open_ports[count]))
    print(banner)
    print(target.open_ports[count])
    count+=1